{% extends "blog/base.html" %}
{% block title %}Home - The Byline{% endblock %}

{%block nav%}

<!-- Navigation Section -->
<nav class="hidden md:block bg-white border-b border-gray-200 sticky top-0 z-40 sticky">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-around py-4">

      <!-- Navigation Links -->
      <div class="flex items-center space-x-8">
        <a href="{% url 'home' %}" class="{% if request.path == '/' %}text-byline-yellow font-semibold{% else %}text-black{% endif %} text-black hover:text-byline-yellow font-medium transition-colors">Home</a>
        <a href="{% url 'category_articles' 'business'  %}"
          class="{% if request.path == '/category/market/' or request.path == '/category/gold/' or request.path == '/category/business/' %}text-byline-yellow font-semibold{% else %}text-black {% endif %} hover:text-byline-yellow font-medium transition-colors">Business</a>
        <a href="{% url 'category_articles' 'economy' %}"
          class="{% if request.path == '/category/economy/' %}text-byline-yellow font-semibold{% else %}text-black{% endif %}hover:text-byline-yellow font-medium transition-colors">Economy</a>

        <div class="relative group">
          <button class="{% if request.path == '/category/cricket/' or request.path == '/category/football/' or  request.path == '/category/tennis/' %}text-byline-yellow font-semibold{% else %}text-black{% endif %} hover:text-byline-yellow font-medium transition-colors">Sports</button>
          <div
            class="absolute top-full left-0 mt-2 w-48 bg-white border border-gray-200 shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
            <div class="py-2">
              <a href="{% url 'category_articles' 'cricket' %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-byline-yellow">Cricket</a>
              <a href="{% url 'category_articles' 'football' %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-byline-yellow">Football</a>
              <a href="{% url 'category_articles' 'tennis' %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-byline-yellow">Tennis</a>
            </div>
          </div>
        </div>

      </div>

      <!-- Search Bar -->
      <div class="flex items-center space-x-6">
        <div class="relative">
          <form method="GET" action="{% url 'home' %}" class="relative max-w-xs hidden md:flex">

            <input type="text" name="q" placeholder="Search articles..." value="{{ search_query }}"
              class="pl-10 pr-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500" />
            <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" fill="none"
              stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </form>
        </div>
      </div>
    </div>
  </div>
</nav>
{%endblock%}
{% block content %}

<!-- üèè Live Scores at Top -->
<!-- <section class="mb-10">
  <h2 class="text-xl font-bold text-gray-800 font-merriweather mb-4">üèè Live Cricket Scores</h2>
  <div id="cricket-live" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-sm text-gray-700 font-roboto">
    <p>Loading scores...</p>
  </div>
</section> -->

<!-- ‚úÖ Thank You Message for Newsletter -->
{% if messages %}
{% for message in messages %}
<div id="message-container" class="mb-4 px-4 py-3 bg-green-100 text-green-800 rounded-lg shadow-sm">
  {{ message }}
</div>
{% endfor %}
{% endif %}

<!-- üî≥ Main Grid: Articles + Opinions -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-10">

  <!-- üìÑ LEFT: Articles -->
  <div class="lg:col-span-2">
    <h2 class="text-3xl font-playfair text-gray-900 mb-6 border-b-2 border-byline-yellow pb-2">
      {% if current_category %}{{ current_category }} News{% else %}Current updates{% endif %}
    </h2>

    {% if articles %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for article in articles %}
      <div class="bg-white shadow rounded-xl overflow-hidden hover:shadow-lg transition duration-300">
        {% if article.image %}
        <img src="{{ article.image.url }}" alt="{{ article.title }}" class="w-full h-48 object-cover">
        {% endif %}
        <div class="p-4">
          <h3 class="text-lg font-semibold text-gray-900 font-playfair hover:text-byline-yellow transition">
            <a href="{% url 'article_detail' slug=article.slug %}">{{ article.title }}</a>
          </h3>
          <p class="text-sm text-gray-600 mt-2">{{ article.summary|truncatechars:120 }}</p>
          <a href="{% url 'article_detail' slug=article.slug %}"
            class="text-byline-yellow hover:text-blue-800 text-sm font-medium mt-3 inline-block">
            Read more ‚Üí
          </a>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-gray-500 text-sm">No articles available at the moment.</p>
    {% endif %}
  </div>

  <!-- üß† RIGHT: Search + Opinions -->
  <div>


    <h2 class="text-2xl font-bold mb-4 border-b-2 border-byline-yellow pb-2">Opinion Articles</h2>

    <!-- Fixed height + scrollable + hidden scrollbar -->
    <div class="max-h-[400px] overflow-y-auto pr-2 space-y-4">
      {% for opinion in opinion_articles %}
      <div class="bg-white p-4 rounded-xl shadow flex items-start gap-4 hover:shadow-md transition">
        {% if opinion.authorImage %}
        <img src="{{ opinion.authorImage.url }}" alt="{{ opinion.author }}" class="w-12 h-12 rounded-full object-cover">
        {% endif %}
        <div>
          <h4 class="font-semibold text-gray-900">{{ opinion.title }}</h4>
          <p class="text-sm text-gray-500 mb-1">By {{ opinion.author }}</p>
          <p class="text-sm text-gray-600">{{ opinion.snippet|truncatewords:15 }}</p>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- üíå Newsletter Form (Centered) -->
<!-- <section id="subscribe" class="bg-gray-100 py-10 px-6 rounded-lg mt-16 max-w-4xl mx-auto text-center">
  <h2 class="text-2xl font-semibold mb-4 text-gray-900 font-merriweather">
    Get the best of Business & Sports in your inbox.
  </h2>

  <form method="POST" class="flex flex-col sm:flex-row items-center justify-center gap-4 max-w-md mx-auto mb-6">
    {% csrf_token %}
    <input type="email" name="email" placeholder="Enter your email" required
      class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring focus:border-blue-400">
    <button type="submit"
      class="hover:bg-white bg-byline-yellow text-white hover:text-byline-yellow font-semibold py-2 px-6 rounded-md">
      Subscribe
    </button>
  </form>

  <ul class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-6 text-sm text-gray-700">
    <li><strong>Weekly summaries</strong></li>
    <li><strong>Hand-picked reads</strong></li>
    <li><strong>No spam, Ever</strong></li>
  </ul>
</section> -->

<!-- üèè Cricket Scores Script -->
<!-- <script>
  let apiCallCount = 0;
  let hasFetchedOnce = false;

  async function fetchCricketLiveScores(force = false) {
    if (hasFetchedOnce && !force) return;
    apiCallCount++;
    hasFetchedOnce = true;

    try {
      const res = await fetch("https://cricbuzz-cricket.p.rapidapi.com/matches/v1/live", {
        method: "GET",
        headers: {
          "X-RapidAPI-Key": "{{crick_key}}",
          "X-RapidAPI-Host": "cricbuzz-cricket.p.rapidapi.com"
        }
      });

      const data = await res.json();
      const container = document.getElementById("cricket-live");
      container.innerHTML = "";

      const matches = data.typeMatches?.[0]?.seriesMatches?.flatMap(series =>
        series.seriesAdWrapper?.matches || []
      ).slice(0, 4);

      if (!matches?.length) {
        container.innerHTML = "<p>No live matches right now.</p>";
        return;
      }

      matches.forEach(match => {
        const info = match.matchInfo;
        const score = match.matchScore;

        const team1 = info?.team1?.teamName || "Team A";
        const team2 = info?.team2?.teamName || "Team B";
        const venue = info?.venueInfo?.ground || "Unknown venue";
        const status = score?.status || "Live";

        const t1Score = score?.team1Score?.inngs1;
        const t2Score = score?.team2Score?.inngs1;

        const formatScore = s => s ? `${s.runs}/${s.wickets} (${s.overs} ov)` : "N/A";

        const el = document.createElement("div");
        el.className = "border p-3 rounded bg-gray-50 shadow-sm";

        el.innerHTML = `
        <div class="font-semibold text-gray-800">${team1} vs ${team2}</div>
        <div class="text-sm text-gray-600 mb-1">${venue}</div>
        <div class="text-sm">
          <span class="font-medium text-blue-700">${team1}:</span> ${formatScore(t1Score)}<br>
          <span class="font-medium text-blue-700">${team2}:</span> ${formatScore(t2Score)}
        </div>
        <div class="mt-1 text-xs text-green-600 font-semibold">${status}</div>
      `;
        container.appendChild(el);
      });

    } catch (err) {
      console.error("API Error:", err);
      document.getElementById("cricket-live").innerHTML = "<p class='text-red-600'>Unable to fetch scores.</p>";
    }
  }

  function isVisible(elem) {
    const rect = elem.getBoundingClientRect();
    return rect.top < window.innerHeight && rect.bottom > 0;
  }

  function checkAndFetchOnce() {
    const block = document.getElementById("cricket-live");
    if (block && isVisible(block)) {
      fetchCricketLiveScores();
      window.removeEventListener("scroll", checkAndFetchOnce);
    }
  }

  window.addEventListener("DOMContentLoaded", checkAndFetchOnce);
  window.addEventListener("scroll", checkAndFetchOnce);
  setInterval(() => { fetchCricketLiveScores(true); }, 60000);
</script> -->

<script>
   setTimeout(() => {
    const container = document.getElementById('message-container');
    if (container) {
      container.style.opacity = '0';
      container.style.transition = 'opacity 1s ease';
      setTimeout(() => container.remove(), 1000); // Remove from DOM after fade
    }
  }, 4000); // 4 seconds

</script>

{% endblock %}