{% extends "blog/base.html" %}
{% block title %}Home - The Byline{% endblock %}

{%block nav%}

<!-- Navigation Section -->
<nav class="hidden md:block bg-white border-b border-gray-200 sticky top-0 z-40">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-around py-4">
      <!-- Search Bar -->
      <div class="flex items-center space-x-6">
        <div class="relative">
          <form method="GET" action="{% url 'home' %}" class="relative max-w-xs hidden md:flex">

            <input id="searchBox" type="text" name="q" placeholder="Search" value="{{ search_query }}"
              class="pl-10 pr-4 py-2 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-gray-300" />
            <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-black w-4 h-4" fill="none"
              stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </form>

          <div id="liveResults" class="absolute bg-white shadow-md rounded z-50"></div>
        </div>
      </div>




      <!-- Navigation Links -->
      <div class="flex items-center space-x-8 mr-[30rem]">
        <a href="{% url 'home' %}"
          class="{% if request.path == '/' %}text-red-600 font-semibold{% else %}text-black{% endif %} hover:text-red-600 transition-colors group relative">
          Home
          <span
            class="absolute left-0 bottom-0 w-0 h-0.5 bg-red-600 transition-all duration-300 group-hover:w-full"></span>
        </a>
        <a href="{% url 'category_articles' 'business'  %}"
          class="{% if request.path == '/category/market/' or request.path == '/category/gold/' or request.path == '/category/business/' %}text-red-600 font-semibold{% else %}text-black {% endif %} hover::text-red-600 font-medium transition-colors group relative">Business
          <span
            class="absolute left-0 bottom-0 w-0 h-0.5 bg-red-600 transition-all duration-300 group-hover:w-full"></span>
        </a>
        <a href="{% url 'category_articles' 'economy' %}"
          class="{% if request.path == '/category/economy/' %}:text-red-600 font-semibold{% else %}text-black{% endif %}hover::text-red-600 font-medium transition-colors group relative">Economy
          <span
            class="absolute left-0 bottom-0 w-0 h-0.5 bg-red-600 transition-all duration-300 group-hover:w-full"></span>
        </a>

        <div class="relative group">
          <button
            class="{% if request.path == '/category/cricket/' or request.path == '/category/football/' or  request.path == '/category/tennis/' %}text-red-600 font-semibold{% else %}text-black{% endif %} hover:text-red-600 font-medium transition-colors relative">Sports
            <span
              class="absolute left-0 bottom-0 w-0 h-0.5 bg-red-600 transition-all duration-300 group-hover:w-full"></span>
          </button>
          <div
            class="absolute top-full left-0 mt-2 w-48 bg-white border border-gray-200 shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
            <div class="py-2">
              <a href="{% url 'category_articles' 'cricket' %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-red-600 group/item relative">Cricket
                <span
                  class="absolute left-4 bottom-0 w-0 h-0.5 bg-red-600 transition-all duration-300 group-hover/item:w-12"></span>
              </a>
              <a href="{% url 'category_articles' 'football' %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-red-600 group/item relative">Football
                <span
                  class="absolute left-4 bottom-0 w-0 h-0.5 bg-red-600 transition-all duration-300 group-hover/item:w-12"></span>
              </a>
              <a href="{% url 'category_articles' 'tennis' %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover::text-red-600 group/item relative">Tennis
                <span
                  class="absolute left-4 bottom-0 w-0 h-0.5 bg-red-600 transition-all duration-300 group-hover/item:w-12"></span>
              </a>
            </div>
          </div>
        </div>

      </div>



    </div>
  </div>
</nav>
{%endblock%}
{% block content %}

<!-- üèè Live Scores at Top -->
<!-- <section class="mb-10">
  <h2 class="text-xl font-bold text-gray-800 font-merriweather mb-4">üèè Live Cricket Scores</h2>
  <div id="cricket-live" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-sm text-gray-700 font-roboto">
    <p>Loading scores...</p>
  </div>
</section> -->

<!-- ‚úÖ Thank You Message for Newsletter -->
{% if messages %}
{% for message in messages %}
<div id="message-container" class="mb-4 px-4 py-3 bg-green-100 text-green-800 rounded-lg shadow-sm">
  {{ message }}
</div>
{% endfor %}
{% endif %}


<!-- üìÑ Main grid layout -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-10">

  <!-- üìÑ LEFT: News and Search -->
  <div class="lg:col-span-2">
    {% if search_query %}
      <!-- üîç Search Result Block -->
      <h2 class="text-3xl font-playfair text-gray-900 mb-6 border-b-2 border-[#BA0000] pb-2">
        Search results for "<span class="text-black">{{ search_query }}</span>"
      </h2>

      {% if articles %}
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for article in articles %}
        <div class="bg-white shadow rounded-xl overflow-hidden hover:shadow-lg transition duration-300">
          {% if article.image %}
          <img src="{{ article.image.url }}" class="w-full h-48 object-cover" />
          {% endif %}
          <div class="p-4">
            <h3 class="text-lg font-semibold text-gray-900 font-playfair hover:text-red-600 transition">
              <a href="{% url 'article_detail' slug=article.slug %}">{{ article.title|safe }}</a>
            </h3>
            <p class="text-sm text-gray-600 mt-2">{{ article.summary|safe|truncatechars:150 }}</p>
            <a href="{% url 'article_detail' slug=article.slug %}"
              class="text-red-600 hover:text-black text-sm font-medium mt-3 inline-block">
              Read more ‚Üí
            </a>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-gray-500 text-sm mt-4">No results found. Try a different keyword.</p>
      {% endif %}

    {% else %}
      <!-- üì∞ LATEST NEWS section from category-wise featured -->
      <h2 class="text-3xl font-playfair text-gray-900 mb-6 border-b-2 border-red-600 pb-2">
        Latest News
      </h2>

      {% comment %} First featured item (full width) {% endcomment %}
      {% for category, data in category_articles.items %}
      {% if forloop.first %}
      <div class="mb-6">
        <div
          class="bg-white shadow rounded-xl overflow-hidden hover:shadow-lg transition duration-300 flex flex-col sm:flex-row relative">
          {% if data.featured.image %}
          <img src="{{ data.featured.image.url }}" alt="{{ data.featured.title }}"
            class="w-full sm:w-1/3 h-64 object-cover">
          {% endif %}
          <div class="p-6 sm:w-2/3">
            <span class="absolute top-0 left-0 bg-red-600 text-white text-xs font-semibold px-3 py-1 rounded-br-lg">
              {{ category.name }}
            </span>
            <h3 class="text-2xl font-semibold text-gray-900 font-playfair hover:text-red-600 transition">
              <a href="{% url 'article_detail' slug=data.featured.slug %}">{{ data.featured.title }}</a>
            </h3>
            <p class="text-sm text-gray-600 mt-3">{{ data.featured.summary|truncatechars:200 }}</p>
            <a href="{% url 'article_detail' slug=data.featured.slug %}"
              class="text-red-600 hover:text-black text-sm font-medium mt-4 inline-block">
              Read more ‚Üí
            </a>
          </div>
        </div>
      </div>
      {% endif %}
      {% endfor %}

      <!-- Next 3 featured articles in grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for category, data in category_articles.items %}
        {% if not forloop.first and forloop.counter <= 4 %}
        <div class="bg-white shadow rounded-xl overflow-hidden hover:shadow-lg transition duration-300 relative">
          {% if data.featured.image %}
          <img src="{{ data.featured.image.url }}" alt="{{ data.featured.title }}" class="w-full h-48 object-cover">
          {% endif %}
          <span class="absolute top-0 left-0 bg-red-600 text-white text-xs font-semibold px-3 py-1 rounded-br-lg">
            {{ category.name }}
          </span>
          <div class="p-4">
            <h3 class="text-lg font-semibold text-gray-900 font-playfair hover:text-red-600 transition">
              <a href="{% url 'article_detail' slug=data.featured.slug %}">{{ data.featured.title }}</a>
            </h3>
            <p class="text-sm text-gray-600 mt-2">{{ data.featured.summary|truncatechars:120 }}</p>
            <a href="{% url 'article_detail' slug=data.featured.slug %}"
              class="text-red-600 hover:text-black text-sm font-medium mt-3 inline-block">
              Read more ‚Üí
            </a>
          </div>
        </div>
        {% endif %}
        {% endfor %}
      </div>

      <!-- üóÇÔ∏è CATEGORY SECTIONS -->
      {% for category, data in category_articles.items %}
      <section class="mt-10 mb-12">
        <h2 class="text-3xl font-playfair text-gray-900 mb-6 border-b-2 border-[#BA0000] pb-2">
          <a href="{% url 'category_articles' category.name %}" class="hover:text-red-600">
            {{ category.name|capfirst }} News
          </a>
        </h2>

        <!-- Featured full-width article -->
        <div class="mb-6">
          <div
            class="bg-white shadow rounded-xl overflow-hidden hover:shadow-lg transition duration-300 flex flex-col sm:flex-row">
            {% if data.featured.image %}
            <img src="{{ data.featured.image.url }}" alt="{{ data.featured.title }}"
              class="w-full sm:w-1/3 h-64 object-cover">
            {% endif %}
            <div class="p-6 sm:w-2/3">
              <h3 class="text-2xl font-semibold text-gray-900 font-playfair hover:text-red-600 transition">
                <a href="{% url 'article_detail' slug=data.featured.slug %}">{{ data.featured.title }}</a>
              </h3>
              <p class="text-sm text-gray-600 mt-3">{{ data.featured.summary|truncatechars:200 }}</p>
              <a href="{% url 'article_detail' slug=data.featured.slug %}"
                class="text-red-600 hover:text-black text-sm font-medium mt-4 inline-block">
                Read more ‚Üí
              </a>
            </div>
          </div>
        </div>

        <!-- Other articles in grid -->
        {% if data.others %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {% for article in data.others %}
          <div class="bg-white shadow rounded-xl overflow-hidden hover:shadow-lg transition duration-300">
            {% if article.image %}
            <img src="{{ article.image.url }}" alt="{{ article.title }}" class="w-full h-48 object-cover">
            {% endif %}
            <div class="p-4">
              <h3 class="text-lg font-semibold text-gray-900 font-playfair hover:text-red-600 transition">
                <a href="{% url 'article_detail' slug=article.slug %}">{{ article.title }}</a>
              </h3>
              <p class="text-sm text-gray-600 mt-2">{{ article.summary|truncatechars:120 }}</p>
              <a href="{% url 'article_detail' slug=article.slug %}"
                class="text-red-600 hover:text-black text-sm font-medium mt-3 inline-block">
                Read more ‚Üí
              </a>
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}
      </section>
      {% endfor %}
    {% endif %}
  </div>

  <!-- üß† RIGHT: Opinions Sidebar -->
  <div>
    <h2 class="text-2xl font-bold mb-4 border-b-2 border-[#BA0000] pb-2">Opinion Articles</h2>

    <div class="max-h-[400px] overflow-y-auto pr-2 space-y-4">
      {% for opinion in opinion_articles %}
      <div class="bg-white p-4 rounded-xl shadow flex items-start gap-4 hover:shadow-md transition">
        {% if opinion.authorImage %}
        <img src="{{ opinion.authorImage.url }}" alt="{{ opinion.author }}" class="w-12 h-12 rounded-full object-cover">
        {% endif %}
        <a href="{% url 'article_detail' slug=opinion.slug %}">
          <h4 class="font-semibold text-gray-900">{{ opinion.title }}</h4>
          <p class="text-sm text-gray-500 mb-1">By {{ opinion.author }}</p>
          <p class="text-sm text-gray-600">{{ opinion.snippet|truncatewords:15 }}</p>
        </a>
      </div>
      {% endfor %}
    </div>
  </div>
</div> <!-- End of main grid -->




<!-- üíå Newsletter Form (Centered) -->
<!-- <section id="subscribe" class="bg-gray-100 py-10 px-6 rounded-lg mt-16 max-w-4xl mx-auto text-center">
  <h2 class="text-2xl font-semibold mb-4 text-gray-900 font-merriweather">
    Get the best of Business & Sports in your inbox.
  </h2>

  <form method="POST" class="flex flex-col sm:flex-row items-center justify-center gap-4 max-w-md mx-auto mb-6">
    {% csrf_token %}
    <input type="email" name="email" placeholder="Enter your email" required
      class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring focus:border-blue-400">
    <button type="submit"
      class="hover:bg-white bg-byline-yellow text-white hover:text-byline-yellow font-semibold py-2 px-6 rounded-md">
      Subscribe
    </button>
  </form>

  <ul class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-6 text-sm text-gray-700">
    <li><strong>Weekly summaries</strong></li>
    <li><strong>Hand-picked reads</strong></li>
    <li><strong>No spam, Ever</strong></li>
  </ul>
</section> -->

<!-- üèè Cricket Scores Script -->
<!-- <script>
  let apiCallCount = 0;
  let hasFetchedOnce = false;

  async function fetchCricketLiveScores(force = false) {
    if (hasFetchedOnce && !force) return;
    apiCallCount++;
    hasFetchedOnce = true;

    try {
      const res = await fetch("https://cricbuzz-cricket.p.rapidapi.com/matches/v1/live", {
        method: "GET",
        headers: {
          "X-RapidAPI-Key": "{{crick_key}}",
          "X-RapidAPI-Host": "cricbuzz-cricket.p.rapidapi.com"
        }
      });

      const data = await res.json();
      const container = document.getElementById("cricket-live");
      container.innerHTML = "";

      const matches = data.typeMatches?.[0]?.seriesMatches?.flatMap(series =>
        series.seriesAdWrapper?.matches || []
      ).slice(0, 4);

      if (!matches?.length) {
        container.innerHTML = "<p>No live matches right now.</p>";
        return;
      }

      matches.forEach(match => {
        const info = match.matchInfo;
        const score = match.matchScore;

        const team1 = info?.team1?.teamName || "Team A";
        const team2 = info?.team2?.teamName || "Team B";
        const venue = info?.venueInfo?.ground || "Unknown venue";
        const status = score?.status || "Live";

        const t1Score = score?.team1Score?.inngs1;
        const t2Score = score?.team2Score?.inngs1;

        const formatScore = s => s ? `${s.runs}/${s.wickets} (${s.overs} ov)` : "N/A";

        const el = document.createElement("div");
        el.className = "border p-3 rounded bg-gray-50 shadow-sm";

        el.innerHTML = `
        <div class="font-semibold text-gray-800">${team1} vs ${team2}</div>
        <div class="text-sm text-gray-600 mb-1">${venue}</div>
        <div class="text-sm">
          <span class="font-medium text-blue-700">${team1}:</span> ${formatScore(t1Score)}<br>
          <span class="font-medium text-blue-700">${team2}:</span> ${formatScore(t2Score)}
        </div>
        <div class="mt-1 text-xs text-green-600 font-semibold">${status}</div>
      `;
        container.appendChild(el);
      });

    } catch (err) {
      console.error("API Error:", err);
      document.getElementById("cricket-live").innerHTML = "<p class='text-red-600'>Unable to fetch scores.</p>";
    }
  }

  function isVisible(elem) {
    const rect = elem.getBoundingClientRect();
    return rect.top < window.innerHeight && rect.bottom > 0;
  }

  function checkAndFetchOnce() {
    const block = document.getElementById("cricket-live");
    if (block && isVisible(block)) {
      fetchCricketLiveScores();
      window.removeEventListener("scroll", checkAndFetchOnce);
    }
  }

  window.addEventListener("DOMContentLoaded", checkAndFetchOnce);
  window.addEventListener("scroll", checkAndFetchOnce);
  setInterval(() => { fetchCricketLiveScores(true); }, 60000);
</script> -->

<script>
  setTimeout(() => {
    const container = document.getElementById('message-container');
    if (container) {
      container.style.opacity = '0';
      container.style.transition = 'opacity 1s ease';
      setTimeout(() => container.remove(), 1000); // Remove from DOM after fade
    }
  }, 4000); // 4 seconds




</script>

{% endblock %}